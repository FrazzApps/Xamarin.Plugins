{"Name":"Xamarin.InAppBilling","Id":1119,"Alias":"xamarin.inappbilling","Description":"###About Xamarin.InAppBilling###\n\nIn-app Billing is a Google Play service that lets you sell a wide range digital content such as new game levels, downloadable media, or premium features directly from inside your Xamarin.Android mobile application. These purchases can either be standard, one-time billed products or recurring, automatically billed subscriptions.\n\nThe `Xamarin.InAppBilling` component simplifies the process of supporting In-App Billing (Version 3 API) by reducing the amount of common, repetitive code required and by adding several useful, helper functions.\n\n###Features###\n\n`Xamarin.InAppBilling` supports the following features:\n\n* **Connect** - Attaches your Xamarin.Android app to Google Play to process In-App Billing transactions.\n* **QueryInventoryAsync** - Given a list of Product IDs, this routine will return all available, active products matching those IDs not already purchased by the current user.\n* **GetPurchases** - Returns a list of all purchases made by the current user.\n* **BuyProduct** - Calls Google Play to purchase the given product.\n* **ConsumePurchase** - Given a purchased product, this routine informs Google Play that the given product has been consumed and is available for purchase again.\n* **Disconnect** - Unbinds from Google Play when your Activity ends.\n\n###Events###\n\n`Xamarin.InAppBilling` defines the following events that you can monitor and respond to:\n\n* **OnConnected** - Raised when the component attaches to Google Play.\n* **OnDisconnected** - Raised when the component detaches from Google Play.\n* **OnInAppBillingError** - Raised when an error occurs inside the component.\n* **OnProductPurchasedError** - Raised when there is an error purchasing a product or subscription.\n* **OnProductPurchased** - Raised when a product or subscription is fully processed by Google Play and returned.\n* **OnPurchaseConsumedError** - Raised when there is an error consuming a purchase.\n* **OnPurchaseConsumed** - Raised when a purchase is successfully consumed.\n* **OnPurchaseFailedValidation** - Raised when a previous purchase fails validation.\n* **OnGetProductsError** - Raised when a request to *GetProducts* fails.\n* **OnInvalidOwnedItemsBundleReturned** - Raised when an invalid bundle of purchases is returned from Google Play.\n* **InAppBillingProcessingError** - Raised when any other type of processing issue not covered by an existing event occurs.\n* **OnUserCanceled** - Raised when a user cancels an In App Billing request.\n* **QueryInventoryError** - Raised if there is an error querying Google Play Services for available inventory.\n* **BuyProductError** - Raised if there is an error buying a product from Google Play Services.\n\n###Secure Transactions###\n\nWhen developing Xamarin.Android applications that support In-App Billing there are several steps that should be taken to protect your app from being hacked by a malicious user and keep unlocked content safe.\n\nWhile the best practice is to perform signature verification on a remote server and not on a device, this might not always be possible. Another technique is to obfuscate your Google Play public key and never store the assembled key in memory. \n\n`Xamarin.InAppBilling` provides a quick and simple method to break your public key into a several pieces and to obfuscate those pieces. Once a public key has been provided to `Xamarin.InAppBilling` it is never stored as plain text, it is always encrypted in memory.\n\n###Required Setup and Limitations###\n\nWhile using the `Xamarin.InAppBilling` component greatly simplifies the amount of code required to use In-App Billing in your Xamarin.Android mobile application, the component still uses the Google Play In-App Billing (Version 3 API) to perform In-App Billing tasks and as such, has the same limitations and setup requirements as using the In-App Billing (Version 3 API) directly in your app.\n\nTo properly use the `Xamarin.InAppBilling` component, please follow all of the setup and testing instructions in the **Getting Started** document included with the component.\n\n###Android Examples###\n\nAnd here is a simplified example of adding In-App Billing to an Android **Activity** using `Xamarin.InAppBilling`:\n\n```\nusing Xamarin.InAppBilling;\nusing Xamarin.InAppBilling.Utilities;\n...\n\n// Create a new connection to the Google Play Service\n_serviceConnection = new InAppBillingServiceConnection (this, \"\u003cpublic-key\u003e\");\n_serviceConnection.OnConnected += () =\u003e {\n\t\t\t\t\n\t// Load inventory or available products\n\tGetInventory();\n\n\t// Load any items already purchased\n\tLoadPurchasedItems();\n};\n\n// Attempt to connect to the service\n_serviceConnection.Connect ();\n...\n\nprivate async Task GetInventory () {\n\t// Ask the open connection\u0027s billing handler to return a list of available products for the \n\t// given list of items.\n\t// NOTE: We are asking for the Reserved Test Product IDs that allow you to test In-App\n\t// Billing without actually making a purchase.\n\t_products = await _serviceConnection.BillingHandler.QueryInventoryAsync (new List\u003cstring\u003e \t{\n\t\tReservedTestProductIDs.Purchased,\n\t\tReservedTestProductIDs.Canceled,\n\t\tReservedTestProductIDs.Refunded,\n\t\tReservedTestProductIDs.Unavailable\n\t}, ItemType.Product);\n\n\t// Were any products returned?\n\tif (_products == null) {\n\t\t// No, abort\n\t\treturn;\n\t}\n\t...\n}\n...\n\nprivate void LoadPurchasedItems () {\n\t// Ask the open connection\u0027s billing handler to get any purchases\n\tvar purchases = _serviceConnection.BillingHandler.GetPurchases (ItemType.Product);\n\n\t// Display any existing purchases\n\t...\n}\n...\n\n// Configure buy button\n_buyButton.Click += (sender, e) =\u003e {\n\t// Ask the open connection\u0027s billing handler to purchase the selected product\n\t_serviceConnection.BillingHandler.BuyProduct(_selectedProduct);\n};\n\n```\n\nPlease see the **Getting Started** documentation for full instructions on configuring, implementing and testing the `Xamarin.InAppBilling` component in a Xamarin.Android mobile application. The **Getting Started** documentation also includes a _Troubleshooting_ section to help diagnose and fix common issues may occur when using the component.\n\n_Some screenshots created with [PlaceIt](http://placeit.breezi.com \"PlaceIt by Breezi\")._\n","Version":"2.1","Summary":"Component to assist in adding In-App Billing to a Xamarin.Android application via Google Play Services.","QuickStart":"##Xamarin.InAppBilling Component##\n\n###Getting Started with Xamarin.InAppBilling###\n\nTo use an `Xamarin.InAppBilling` in your mobile application include the component in your project and reference the following using statements in your C# code:\n\n```\nusing Xamarin.InAppBilling;\nusing Xamarin.InAppBilling.Utilities;\n``` \n\n###Installing the Google Play Billing Library###\n\nBefore you can use the `Xamarin.InAppBilling` component in your Xamarin.Android mobile application, you need to ensure that the latest version of the **Google Play Billing Library** is installed on your development computer.\n\nTo install the library (or update to the latest version), do the following:\n\n1. Start Xamarin Studio.\n2. From the **Tools** menu select **Open Android SDK Manager...**\n3. Open the **Extras** folder and place a check by the **Google Play Billing Library** entry.\n4. Click the **Install packages...** button.\n5. Approve any required licenses.\n6. Download and install the required library (and any other updates that the SDK manager finds). \n\n\n###Preparing Your App for In-App Billing###\n\nBefore the `Xamarin.InAppBilling` component can be successfully added to a Xamarin.Android mobile application and used for Google Play In-App Billing, there are several initial setup steps that need to be performed. Using the **Google Play Developer Console**, you will establish an application (that will later be available for sale or free download from the Google Play Store) and manage the various digital goods that will be available for purchase from within you application.\n\nWhen you create a new application in the **Developer Console**, it will automatically generate a public license key for your app, that you will later use to sign the application and provide to the `Xamarin.InAppBilling` to verify In-App Billing transactions. See the _A Special Note on Security_ and _Connecting to Google Play_ sections below for more information.\n\nIf you have not already done so, you\u0027ll need to register as a developer with the [Google Play](http://developer.android.com). Additionally, to sell In App Products, you\u0027ll also need to have a [Google Wallet](http://www.google.com/wallet/merchants.html) Merchant Account.\n\nTo add your application to the Developer Console, please do the following:\n\n1. In a web browser navigate to the [Google Play Developer Console](http://play.google.com/apps/publish) and log in.\n2. Click on the **All Applications** tab on the left hand side of the screen.\n3. Click on the **+ Add New Application** button.\n4. Enter a **Title** for the application that you intent to sell In-App Products from.\n5. Click the **Prepare Store Listing** button. You\u0027ll be taken to the **Application Details** Page.\n6. Fill out the rest of the information on this page and click the **Save** button at the top of the screen.\n7. Click on the **Services \u0026 APIs** tab for your application.\n8. Copy the **YOUR LICENSE KEY FOR THIS APPLICATION** key. This is your **Public Key** and you\u0027ll need it to sign your application later and to validate any In-App Billing transactions.\n9. Return to Xamarin Studio and use the **Public Key** from above to establish a connection from the `Xamarin.InAppBilling` component and the Google Play Store. See the _Connecting to Google Play_ section below for more information.\n\n_**NOTE:** Special care should be taken when copying and pasting the Public Key from the **Google Play Developer Console** to ensure that no hidden, \"white space\" characters are included. The key used in your application must match the one from the **Developer Console** exactly or any In-App Billing transactions will fail._\n\n###Setting the Application\u0027s Billing Permission###\n\nBefore your application can communicate with Google Play’s billing service, it needs to have it\u0027s **Billing Permission** set.\n\nTo add the required permission to your Xamarin.Android mobile application, please do the following:\n\n1. Open the application in Xamarin Studio or Visual Studio.\n2. In the **Solution Explorer** expand the **Properties** folder.\n3. Double-click the `AndroidManifest.xml` file to open it for editing.\n4. Click the **Source** button at the bottom of the screen.\n5. Add the `\u003cuses-permission android:name=\"com.android.vending.BILLING\" /\u003e` line between the `\u003cmanifest\u003e...\u003c/manifest\u003e` tags.\n6. Save the file.\n\n_**NOTE:** If you return to the **Application** view of the `AndroidManifest.xml` file, the **BILLING** line will be displayed in red. This is normal and not an indication of an error._\n\n###A Special Note on Security###\n\nWhen developing Xamarin.Android applications that support In-App Billing there are several steps that should be taken to protect your app from being hacked by a malicious user and keep unlocked content safe.\n\nWhile the best practice is to perform signature verification on a remote server and not on a device, this might not always be possible. Another technique is to obfuscate your Google Play public key and never store the assembled key in memory.\n\n`Xamarin.InAppBilling` provides the **Unify** routine that can be used to break your Google Play public key into two or more pieces and to obfuscate those pieces using one or more key/value pairs. In addition, `Xamarin.InAppBilling` always encrypts your private key while it\u0027s in memory.\n\nHere is an example of using **Unify** to obfuscate a private key:\n\n```\nstring value = Security.Unify (\n\tnew string[] { \"X0X0-1c...\", \"+123+Jq...\", \"//w/2jANB...\", \"...Kl+/ID43\" }, \n\tnew int[] { 2, 3, 1, 0 }, \n\tnew string[] {  \"X0X0-1\", \"9V4XD\", \"+123+\", \"R9eGv\", \"//w/2\", \"MIIBI\", \"+/ID43\", \"9alu4\" });\n```\nWhere the first parameter is an array of strings containing your private key broken into two or more parts in a random order. The second parameter is an array of integers listing of order that the private key parts should be assembled in. The third, optional, parameter is a list of key/value pairs that will be used to replace sequences in the assembled key.\n\n_**Note:** There are several more steps that should be taken to secure your application, please see Google\u0027s official [Security and Design](http://developer.android.com/google/play/billing/billing_best_practices.html) document for further details._\n\n###Connecting to Google Play###\n\nWhen your application\u0027s main activity first starts, you\u0027ll need to initially establish a connection to Google Play services to support In-App Billing.\n\nThe following is an example of using `Xamarin.InAppBilling` to connect to Google Play:\n\n```\nprivate InAppBillingServiceConnection _serviceConnection;\n...\n\n// Create a new connection to the Google Play Service\n_serviceConnection = new InAppBillingServiceConnection (this, publicKey);\n_serviceConnection.OnConnected += () =\u003e {\n\t// Load available products and any purchases\n\t...\n};\n\n// Attempt to connect to the service\n_serviceConnection.Connect ();\n```\n\nThe _OnConnected_ event will be raised once a successful connection to Google Play Services has been established. In the event that the `Xamarin.InAppBilling` component is unable to connect to the Google Play Services API, the _OnInAppBillingError_ event will be raised on the `InAppBillingServiceConnection` object.\n\nThe connection will fail if the Android device does not have the latest version of the Google Play Store loaded or if the current device user is unable to make purchases from the store.\n\n_**Note:** Remember to unbind from the In-app Billing service when you are done with your Activity. If you don’t unbind, the open service connection could cause an Android device’s performance to degrade and provide a bad user experience for the end user of your application._\n\n###Establishing In-App Products for Sale###\n\nBefore you can test or use In-App Billing in your Xamarin.Android mobile application, you\u0027ll need to create the virtual products for your app in the **Google Play Developer Console** and initially upload a testing APK. For more information on testing, please see the _Testing In-App Billing in a Xamarin.Android App_ section below.\n\nTo add new In-App Products to your application, do the following:\n\n1. Build a signed APK for your application. See Xamarin\u0027s [Publishing an Application](http://developer.xamarin.com/guides/android/deployment,_testing,_and_metrics/publishing_an_application/) documentation for the details of creating the required signed APK file. Ensure that you are using your final (not debug) certificate and private key (acquired above) to sign the application\u0027s APK.\n2. Return to the **Google Play Developer Console** and open the application entry created above.\n3. Click on the application\u0027s **APK** tab and select the **ALPHA TESTING** tab.\n4. Click on the **Upload your first APK to Alpha** button.\n5. Browse to the application\u0027s APK you just created and upload the file to the **Developer Console**. Don\u0027t publish your application yet, this step is required to setup and test In-App Products only. You\u0027ll publish the application once it has been fully tested and debugged and is ready for release to the general public.\n6. Click on the application\u0027s **In-app Products** tab.\n7. Click on the **+ Add new product** button at the top of the screen.\n8. Select **Managed product** or **Subscription** and enter a **Product ID** (also referred to as a SKU) for the virtual product that you are creating. A **Product ID** can only be composed of lower-case letters(a-z), numbers(0-9), underline(_) and dot(.). It should also start with lower-case letters or numbers. NOTE: Google In-App Billing Version 3 only supports **Managed Products** or **Subscriptions**.\n9. You\u0027ll be taken the the **Product Details** screen.\n10. Fill in the rest of the information for your virtual product and click the **Save** button at the top of the screen.\n11. From the **Inactive** dropdown list at the top of the screen, select **Activate**. \n12. Repeat the step above to create the rest of the virtual products that your application will require.\n\n---\n_**WARNING!** It may take up to 2-3 hours after uploading the APK for Google Play to recognize your updated APK version. If you try to test your application before your uploaded APK is recognized by Google Play, your application will receive a ‘purchase cancelled’ response with an error message “This version of the application is not enabled for In-app Billing.”_\n\n---\n\n###Reserved Product IDs###\n\nIn addition to the virtual Product IDs that you can create for yourself, Google provides a set of **Reserved Product IDs** that can be used to test your application In-App Billing capabilities.\n\nThe following **Reserved Product IDs** are available:\n\n* **android.test.purchased** - When you make an In-App Billing request with this Product ID, Google Play responds as though you successfully purchased an item. The response includes a JSON string, which contains fake purchase information (for example, a fake order ID). In some cases, the JSON string is signed and the response includes the signature so you can test your signature verification implementation using these responses.\n* **android.test.canceled** - When you make an In-App Billing request with this Product ID Google Play responds as though the purchase was canceled. Cancellation can occur when an error is encountered in the order process, such as an invalid credit card, or when you, the developer, cancel a user\u0027s order before it is charged.\n* **android.test.refunded** - When you make an In-App Billing request with this Product ID, Google Play responds as though the purchase was refunded. Refunds cannot be initiated through Google Play\u0027s In-App Billing service API. Refunds must be initiated by you (the merchant/developer) via your Google Wallet account. After you process a refund request through your Google Wallet merchant account, a refund message is sent to your application by Google Play. This occurs only when Google Play gets notification from Google Wallet that a refund has been made.\n* **android.test.item_unavailable** - When you make an In-app Billing request with this Product ID, Google Play responds as though the item being purchased was not listed in your application\u0027s product list.\n\nWhen using the **Reserved Product IDs**, Google Play will act as if real transactions are occurring, however no real purchases are talking place and no actual financial transactions are being processed. `Xamarin,InAppBilling` provides a `ReservedTestProductIDs` class to make working with **Reserved Product IDs** easier in C# code.\n\n###Requesting Available Products###\n\nOnce you have an open connection you can request a list of available products that the user can purchase by providing a list of product ID (either the ones you created above or a **Reserved Product ID**). Here is an example:\n\n```\nprivate IList\u003cProduct\u003e _products;\n...\n\n_products = await _serviceConnection.BillingHandler.QueryInventoryAsync (new List\u003cstring\u003e {\n\tReservedTestProductIDs.Purchased,\n\tReservedTestProductIDs.Canceled,\n\tReservedTestProductIDs.Refunded,\n\tReservedTestProductIDs.Unavailable\n}, ItemType.Product);\n\n// Were any products returned?\nif (_products == null) {\n\t// No, abort\n\treturn;\n}\n```\nIn the above example we are requesting the four predefined **Reserved Product ID** provided by Google (using the `ReservedTestProductIDs` helper class) to test an application without actually making a purchase.\n\nIf there is an error requesting available product, the _BillingHandler\u0027s_ `QueryInventoryError` event will be raised with the **Response Code** of the error. The **Response Code** can be compared against the `BillingResult` static class to determine the reason for the failure.\n\n###Purchasing a Product###\n\nPurchasing a product can be accomplished using the following:\n\n```\n// Ask the open connection\u0027s billing handler to purchase the selected product\n_serviceConnection.BillingHandler.BuyProduct(_selectedProduct);\n```\nWhere **_selectedProduct** is one of the products returned by the **QueryInventoryAsync** routine above. You *must* make the call to `BuyProduct` from the main thread of your Activity or it will fail.\n\nIf there is an error purchasing a product, the _BillingHandler\u0027s_ `BuyProductError` event will be raised with the **Response Code** of the error. The **Response Code** can be compared against the `BillingResult` static class to determine the reason for the failure.\n\n###Handling the Purchase Result###\n\nTo complete the purchase cycle, you will need to override the **OnActivityResult** method of the Activity of the app that initiated the purchase and pass the result to the _HandleActivityResult_ method of the _BillingHandler_ of your open _InAppBillingServiceConnection_:\n\n```\nprotected override void OnActivityResult (int requestCode, Result resultCode, Intent data)\n{\n\t// Ask the open service connection\u0027s billing handler to process this request\n\t_serviceConnection.BillingHandler.HandleActivityResult (requestCode, resultCode, data);\n\n\t// TODO: Use a call back to update the purchased items\n\t// or listen to the OnProductPurchased event to\n\t// handle a successful purchase\n}\n```\n\nWith the above code in place, you can listen to the `OnProductPurchased` event of the _BillingHandler_ to handle the successful purchase of the product or simply request the full list of purchased products again from the _BillingHandler_.\n\nAny issues processing a purchase will raise either the `OnProductPurchasedError`, `OnPurchaseFailedValidation` or `InAppBillingProcessingError` events with details of the issue that stopped processing. If the user cancels the purchasing of the product, the _BillingHandler\u0027s_ `OnUserCanceled` event will be raised.\n\n---\n\n_**PLEASE NOTE:** The `OnProductPurchased` event will not be raised unless you have overridden the `OnActivityResult` method of the Activity that initiated the purchase and passed the result to the `HandleActivityResult` for processing!_\n\n---\n\n###Requesting a List of Previous Purchases###\n\nAfter the user has purchased one or more products, the following code will request a list of those purchases:\n\n```\n// Ask the open connection\u0027s billing handler to get any purchases\nvar purchases = _serviceConnection.BillingHandler.GetPurchases (ItemType.Product);\n```\n\nIf there is an error getting the list of products, the _BillingHandler\u0027s_ `OnGetProductsError` event will be raised with the **Response Code** of the error. The **Response Code** can be compared against the `BillingResult` static class to determine the reason for the failure.\n\n###Consuming a Purchase###\n\nFor products that are consumable in your application, such as coins or tokens, use the following code to inform Google Play that a given product purchase has been consumed:\n\n```\n// Attempt to consume the given product\nbool result = _serviceConnection.BillingHandler.ConsumePurchase (purchasedItem);\n\n// Was the product consumed?\nif (result) {\n\t// Yes, update interface\n\t...\n}\n```\nWhere **purchasedItem** is a purchase returned by the **GetPurchases** routine above. The _OnPurchaseConsumed_ event will be raised if the product is successful purchased else the _OnPurchaseConsumedError_ event will be raised.\n\n###Disconnecting from Google Play###\n\nWhen you are done with your Activity you must remember to unbind from the In-app Billing service. If you don’t unbind, the open service connection could cause an Android device’s performance to degrade and give the user a bad impression of your application.\n\nTo do this, override you Activity\u0027s **OnDestroy** method and call the **Disconnect** routine:\n\n```\nprotected override void OnDestroy () {\n\t\t\t\n\t// Are we attached to the Google Play Service?\n\tif (_serviceConnection != null) {\n\t\t// Yes, disconnect\n\t\t_serviceConnection.Disconnect ();\n\t}\n\n\t// Call base method\n\tbase.OnDestroy ();\n}\n```\n\n_**Note:** Remember to unbind from the In-app Billing service when you are done with your Activity. If you don’t unbind, the open service connection could cause an Android device’s performance to degrade and provide a bad user experience for the end user of your application._\n\n###Available Events###\n\n`Xamarin.InAppBilling` defines the following events that you can monitor and respond to:\n\n* **OnConnected** - Raised when the component attaches to Google Play.\n* **OnDisconnected** - Raised when the component detaches from Google Play.\n* **OnInAppBillingError** - Raised when an error occurs inside the component.\n* **OnProductPurchasedError** - Raised when there is an error purchasing a product or subscription.\n* **OnProductPurchased** - Raised when a product or subscription is fully processed by Google Play and returned. \n* **OnPurchaseConsumedError** - Raised when there is an error consuming a purchase.\n* **OnPurchaseConsumed** - Raised when a purchase is successfully consumed.\n* **OnPurchaseFailedValidation** - Raised when a previous purchase fails validation. This is ususally caused when the application\u0027s Public Key does not match the Public Key in the Google Developer Console 100%.\n* **OnGetProductsError** - Raised when a request to *GetProducts* fails.\n* **OnInvalidOwnedItemsBundleReturned** - Raised when an invalid bundle of purchases is returned from Google Play.\n* **InAppBillingProcessingError** - Raised when any other type of processing issue not covered by an existing event occurs.\n* **OnUserCanceled** - Raised when a user cancels an In App Billing request.\n* **QueryInventoryError** - Raised if there is an error querying Google Play Services for available inventory.\n* **BuyProductError** - Raised if there is an error buying a product from Google Play Services.\n\n##Testing In-App Billing in a Xamarin.Android App##\n\nBecause of the secure nature of using In-App Billing in a Xamarin.Android mobile application, a special set of procedures are required to properly test an In-App Billing equipped app. In addition, testing should be done early and often to ensure that the purchasing flow is easy to understand, that purchases are happening in a timely fashion and that the customer can easily see what In-App products or subscriptions they have purchased.\n\n###Testing with Static Responses###\n\nInitially you should test your application with the **Reserved Product IDs** provided by Google to make sure that your application properly handles the purchasing workflow and that it gracefully handles any error situation. See the _Reserved Product IDs_ section above for more information.\n\n###Create Testing Accounts###\n\nBefore you can test products that you created in the **Google Play Developer Console**, you need to create one or more **Test Accounts** under your developer profile. You\u0027ll need to use one of these accounts when testing, since Google Play does not allow your Developer Account to directly purchase In-App Products.\n\nTo create the required testing accounts, do the following:\n\n1. In a web browser navigate to the [Google Play Developer Console](http://play.google.com/apps/publish) and log in.\n2. Click the **Settings** tab from the left hand side of the screen.\n3. Click the **User accounts \u0026 rights** tab.\n4. Click the **Invite new user** button at the top of the screen.\n5. Enter the email address for the Test User Account that you are creating. _NOTE: This must be an active, valid Google email address only._\n6. Select a role for the user from the **Role** dropdown list.\n7. Place a check by any rights that want this user to have. In the case of a simple tester, leave all boxes unchecked.\n8. Click the **Send Invitation** button.\n9. The **Pending Invitations** screen will be displayed.\n10. Repeat the steps above to add any other required Test Accounts.\n\nThe Test User Account will receive an email from Google Play that they will need to use to accept the invitation. Once the Test User Account has accepted the invitation, they will be displayed in the **Users With Access** screen of the **Google Play Developer Console** (under **Settings** \u003e **User accounts \u0026 rights**).\n\nIf required, you can adjust the rights of any Test User Account from this screen or remove a Test Account from you Google Play Developer Account if it is no longer needed.\n\n###Uploading Your Test APK###\n\nWith the Test Accounts in place and configured, users with these accounts will be able to make In-App Billing purchases from any uploaded, unpublished applications that you manage.\n\nA properly signed APK registered with the **Google Play Developer Console** is required to test an In-App Billing capable Xamarin.Android mobile application. Attempting to test the application in the Android Simulator or simply starting a debug build in Xamarin Studio and running on a real Android hardware device will fail.\n\nTo register your application\u0027s signed APK, do the following:\n\n1. Open Xamarin Studio and load your Xamarin.Android mobile application\u0027s solution.\n2. Build a signed APK for your application. See Xamarin\u0027s [Publishing an Application](http://developer.xamarin.com/guides/android/deployment,_testing,_and_metrics/publishing_an_application/) documentation for the details of creating the required signed APK file. Ensure that you are using your final (not debug) certificate and private key (acquired above) to sign the application\u0027s APK.\n3. Return to the **Google Play Developer Console** and open the application entry created above.\n4. Click on the application\u0027s **APK** tab and select the **ALPHA TESTING** tab.\n5. Click on the **Upload new APK to Alpha** button.\n6. Browse to the APK file created and signed above and upload the APK to the **Developer Console**.\n\nEnsure that the new signed APK has been uploaded for your application to the **Developer Console**, and that one or more In-App Products have been associated with your app. You don\u0027t need to publish the application on Google Play for your Test User Accounts to test it.\n\n---\n_**WARNING!** It may take up to 2-3 hours after uploading the APK for Google Play to recognize your updated APK version. If you try to test your application before your uploaded APK is recognized by Google Play, your application will receive a ‘purchase cancelled’ response with an error message “This version of the application is not enabled for In-app Billing.”_\n\n---\n\n###Installing the Test APK###\n\nAfter allowing proper time for your new signed APK to be recognized by Google Play Services, your Test Users will need to install the same APK file onto their test devices. Only the Test Users that were created above and that have accepted your invitation to join your Google Play Developer Account will be able to test your In-App Billing products.\n\nGoogle Play does not allow your Developer Account to directly purchase In-App Products, so any Android Device using your Developer Account will not be able to be used for testing, all In-App Billing transactions will fail.\n\nTo install the signed APK on the Test User\u0027s Android hardware device, follow the directions from the [Part 5 - Publishing Independently](http://developer.xamarin.com/guides/android/deployment,_testing,_and_metrics/publishing_an_application/part_5_-_publishing_independently/) section of Xamarin\u0027s [Publishing an Application](http://developer.xamarin.com/guides/android/deployment,_testing,_and_metrics/publishing_an_application/) documentation.\n\nThe following should be noted:\n\n1. By default, Android prevents users from downloading and installing applications from locations other than Google Play. To allow installation from non-marketplace sources, a user must enable the **Unknown sources** setting on a device before attempting to install an application.\n2. Attaching the signed release APK to an e-mail is a quick and easy way to distribute an application to your Test Users. When the user opens the e-mail on an Android-powered device, Android will recognize the APK attachment and display an **Install** button.\n3. It is possible to distribute an application by a web server. This is accomplished by uploading the application\u0027s signed APK to the web server, and then providing a download link to users. When an Android-powered device browses to a link and then downloads the application, that application will automatically be installed once the download is complete.\n4. The application\u0027s APK file can also be manually installed on the Test User\u0027s device using the command-line **Android Debug Bridge** (adb) tool. See the _Manually Installing an APK_ section of the _Part 5 - Publishing Independently_ guide for more information.\n\nIf the Test Users have a previous version of the application currently installed on their device, they my need to uninstall that version of the application prior to installing the new version. To remove an existing Android app, go to **Settings** \u003e **Apps** on the device. Navigate to the application and click the **Uninstall** button to remove the application.\n\n---\n_**WARNING!** The same signed APK file that was uploaded to the **Google Play Developer Console** must be the one installed on the Test User\u0027s Android hardware device, otherwise any In-App Billing transactions will fail!_\n\n---\n\n###Testing with Your Product IDs###\n\nWith the signed APK successfully uploaded and recognized by Google Play, and after the same signed APK has been installed on the Test User\u0027s Android hardware devices, the Test Users can finally test your In-App Billing products.\n\nIt should also be noted, that the Test User Account\u0027s Google email address (that was registered to your Google Play Developer Account above) must be the one used to log into the **Google Play Store** on the Android device and the Test User must be the primary users on the device or any In-App Billing transactions in your application will fail.\n\nThe Test Users should throughly test purchasing every In-App Product that your application supports. Test purchases made by your Test Users are real orders, and Google Play processes them in the same way as any other order. However, when these purchases are complete, Google Play prevents the orders from going to financial processing (ensuring that there are no actual charges to user accounts). Google Play will automatically cancel any completed test orders after 14 days.\n\nFor more information about testing In-App Billing, please see Google\u0027s official [Testing In-app Billing](http://developer.android.com/google/play/billing/billing_testing.html#test-purchases}) documentation.\n\nIf issues are found with your application\u0027s In-App Billing purchases or billing processes and a new, updated version is required for testing, you\u0027ll need to go through the steps outlined in the _Uploading Your Test APK_ and _Installing the Test APK_ sections again.\n\n##Troubleshooting In-App Billing##\n\nGiven the complexity of correctly configuring, compiling, signing an APK, and setting up the **Google Play Developer Console** for any Xamarin.Android mobile application that will be using In-App Billing, issues can sometimes arise.\n\nThe following is a list of the most common things to check when having issues using In-App Billing:\n\n* Ensure that you have the latest version of the `Xamarin.InAppBilling` component, the Android SDK, the Google Play Billing Library, Xamarin.Android and the **Google Play Store** app loaded on the device.\n* Ensure that your application\u0027s **Public Key** matches the one in the **Developer Console** _exactly_ and that it contains no hidden \"white space\" characters.\n* Before your application can communicate with Google Play’s billing service, it needs to have it\u0027s **Billing Permission** set.\n* Ensure that your **Product IDs** match the ones created for your application in the **Developer Console** _exactly_ and that the products have been **Activated**.\n* Ensure that your product types are either **Managed Product** or **Subscription**, as these are the only product types supported by Google Play In-App Billing Version 3.\n* Ensure that you are using your final (not debug) certificate and private key (acquired above) to sign the application\u0027s APK before uploading it to the **Developer Console**.\n* Ensure that you are using the **Release** configuration to compile a clean-build of your Xamarin.Android mobile application in Xamarin Studio or Visual Studio before creating the signed APK.\n* Ensure that your latest signed APK file has been uploaded to the **Developer Console** and that 2-3 hours have gone by so that Google Play has had time to properly register the APK. On rare occasion, it can take up to 24 hours before a new version is recognized.\n* Ensure that the same signed APK file uploaded to the **Developer Console** is the same one installed on the Android hardware device.\n* Testing of your **Product IDs** is only supported on real hardware and not the Android Simulator and running a Debug or Release build on an Android hardware device directly from Xamarin Studio will also fail.\n* Ensure that your Test User Accounts have been created against live, active Google email addresses and that the Test Users have accepted your invitation to join your Google Play Developer Account as testers.\n* Google Play does not allow your Developer Account to make In-App Billing purchases so a Test User Account must be used.\n* Ensure that the Test User Account is the primary user of the Android Hardware device and that the Google email used to create the Test User Account is the same one used to log into the Google Play Store app on the device.\n* The `OnProductPurchased` event will not be raised unless you have overridden the `OnActivityResult` method of the Activity that initiated the purchase and passed the result to the `HandleActivityResult` for processing.\n* The `BuyProduct` method _must_ be called from the main thread of your main Activity or the purchase will fail.\n\n##Examples##\n\nFor full examples of using `Xamarin.InAppBilling` in your mobile application, please see the  _Xamarin.InAppBilling_ example app included with this component.\n\nSee the API documentation for `Xamarin.InAppBilling` for a complete list of features and their usage.\n\n## Other Resources\n\n* [Xamarin Components](https://components.xamarin.com)\n* [Implementing In-app Billing (IAB Version 3)](http://developer.android.com/google/play/billing/billing_integrate.html)\n* [Security and Design](http://developer.android.com/google/play/billing/billing_best_practices.html)\n* [Support](http://xamarin.com/support)","Hash":"945a8b394b3453d8028a227e7e00503d","TargetPlatforms":["android"],"TrialHash":null}